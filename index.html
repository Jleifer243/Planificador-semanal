<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Planificador Escolar Elegante</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    /* --- Tus estilos personalizados y visuales exáctamente como en el archivo original --- */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }
    /* Aquí irán todos los estilos de gradientes, tarjetas, semanas, colores, etc. */
    /* ... (todo el CSS tal como lo tienes) ... */
  </style>
</head>
<body>
  <!-- --- Todo tu HTML original comienza aquí --- -->
  <!-- Mantengo las secciones, contenedores, clases y modales tal como están en tu archivo original --- -->

  <!-- Ejemplo de contenedor principal y tabla, respeta tu estructura -->
  <div class="max-w-screen-xl mx-auto">
    <!-- ... Incluye el header visual, botones de semana, tarjetas y colores originales ... -->
    <header class="..."> <!-- Tu header aquí --> </header>
    <div id="planner-container">
      <!-- Aquí se genera y muestra el planificador (tu cuadrícula, tarjetas, etc.) -->
    </div>
    <!-- Modales originales -->
    <div id="edit-modal" class="modal-container hidden">
      <!-- Contenido modal para añadir tarea -->
    </div>
    <div id="confirm-modal" class="modal-container hidden">
      <!-- Contenido modal para confirmar eliminación -->
    </div>
    <!-- Botón login Google estilo original (añádelo donde mejor encaje visualmente) -->
    <div id="login-container" style="text-align:center; margin-top: 3rem;">
      <button id="google-login-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition duration-300">
        Iniciar sesión con Google
      </button>
    </div>
  </div>
  
  <!-- Loading Overlay visual, igual que tu estilo, oculto por defecto -->
  <div id="loading-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:100; align-items:center; justify-content:center;">
    <span class="font-bold text-2xl mb-2">Conectando...</span>
  </div>

  <!-- --- Añade aquí la integración mínima de Firebase --- -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCfuJa4U3H2Uo4t1qKxeuJTGym70s8QauQ",
      authDomain: "planificador-final-app.firebaseapp.com",
      projectId: "planificador-final-app",
      storageBucket: "planificador-final-app.appspot.com",
      messagingSenderId: "1.018171067065e+12",
      appId: "1:1.018171067065e+12:web:201a8d7ba1445e73afa968"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    const db = getFirestore(app);

    // Referencias
    const loadingOverlay = document.getElementById('loading-overlay');
    const plannerContainer = document.getElementById('planner-container');
    const loginContainer = document.getElementById('login-container');
    // Agrega aquí tus referencias a los elementos visuales del planificador

    // Aquí debes recoger los datos de tu cuadrícula, tarjetas y tareas como tienes en tu JS original
    // Ejemplo básico para guardar el horario (adapta IDs y claves según tu lógica original)
    async function savePlannerForUser(uid, plannerData) {
      loadingOverlay.style.display = 'flex';
      try {
        await setDoc(doc(db, "users", uid), { planner: plannerData }, { merge: true });
      } catch (err) {
        alert("Error al guardar el horario: " + err.message);
      }
      loadingOverlay.style.display = 'none';
    }

    // Para cargar el horario
    async function loadPlannerForUser(uid) {
      loadingOverlay.style.display = 'flex';
      let plannerData = {};
      try {
        const docRef = doc(db, "users", uid);
        const snap = await getDoc(docRef);
        if (snap.exists() && snap.data().planner) {
          plannerData = snap.data().planner;
          // Aquí debes invocar tu función JS que renderiza el planner con esos datos
        }
      } catch (err) {
        alert("Error al cargar el horario: " + err.message);
      }
      loadingOverlay.style.display = 'none';
      // Devuelve los datos para usarlos en tu render
      return plannerData;
    }

    // Login y logout
    document.getElementById('google-login-btn').onclick = () => {
      loadingOverlay.style.display = 'flex';
      signInWithPopup(auth, provider).catch((error) => {
        loadingOverlay.style.display = 'none';
        alert('Error en el login de Google: ' + error.message);
      });
    };
    // Ejemplo botón de logout (adapta según tu propio código)
    // document.getElementById('logout-btn').onclick = () => { signOut(auth); };

    // Muestra tablero solo si está autenticado
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        loadingOverlay.style.display = 'flex';
        loginContainer.style.display = 'none';
        plannerContainer.style.display = 'block';
        // Carga los datos y llama a tu función renderizadora con ellos
        const plannerData = await loadPlannerForUser(user.uid);
        // renderizaPlanner(plannerData); // <-- Aquí tu función JS visual original
        loadingOverlay.style.display = 'none';
      } else {
        loginContainer.style.display = 'block';
        plannerContainer.style.display = 'none';
        loadingOverlay.style.display = 'none';
      }
    });

    // Recuerda: aquí puedes integrar tu lógica JS para cambiar semanas, mostrar modales, asignar colores,
    // según tu código original, solo añade la llamada a guardar y cargar datos en Firestore dentro de
    // los eventos clave (guardar tarea, actualizar semana, etc.)
  </script>
  <!-- --- Resto de scripts JS y lógica visual original -- si tienes archivos o bloques JS lo puedes dejar --- -->

</body>
</html>
